# üìò Seedream V4 Bot

**Seedream V4 Bot** ‚Äî —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ API **Seedream V4** –æ—Ç ByteDance (KIE.ai). –ë–∞–ª–∞–Ω—Å –≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö, –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ YooKassa –∏ Telegram Stars.

## üåü –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**: –ó–∞–≥—Ä—É–∑–∏—Ç–µ 1-10 —Ñ–æ—Ç–æ –∏ –æ–ø–∏—à–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ —Ç–µ–∫—Å—Ç–∞**: –°–æ–∑–¥–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é
- **–ì–æ–ª–æ—Å–æ–≤—ã–µ –ø—Ä–æ–º–ø—Ç—ã**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤
- **–ì–∏–±–∫–∞—è –æ–ø–ª–∞—Ç–∞**: –ö–∞—Ä—Ç—ã –†–§ (YooKassa) –∏ Telegram Stars
- **–†–∞—Å—Å—ã–ª–∫–∏**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ broadcast –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: ARQ –æ—á–µ—Ä–µ–¥–∏ + Redis FSM

## üì¶ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
src/
‚îú‚îÄ core/                  # –∫–æ–Ω—Ñ–∏–≥/–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ db/                    # SQLAlchemy ORM + engine
‚îú‚îÄ vendors/               # –∫–ª–∏–µ–Ω—Ç Seedream V4 (KIE.ai)
‚îú‚îÄ services/              # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ bot/                   # aiogram —Ä–æ—É—Ç–µ—Ä—ã
‚îî‚îÄ web/                   # FastAPI –≤–µ–±—Ö—É–∫–∏
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- **vendors/seedream.py**: –ö–ª–∏–µ–Ω—Ç –¥–ª—è Seedream V4 API
- **services/queue.py**: ARQ –≤–æ—Ä–∫–µ—Ä –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **web/routes/seedream.py**: Webhook –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **bot/routers/generation.py**: FSM –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:
```bash
# Telegram
TELEGRAM_BOT_TOKEN=your_bot_token
WEBHOOK_USE=true
PUBLIC_BASE_URL=https://yourdomain.com
WEBHOOK_SECRET_TOKEN=random_secret

# KIE.ai Seedream V4
KIE_API_KEY=807f26942f5ee7626ff15a6abb4e3d88

# YooKassa
YOOKASSA_SHOP_ID=your_shop_id
YOOKASSA_SECRET_KEY=your_secret
TOPUP_RETURN_URL=https://yourdomain.com/pay/return

# Database
DB_HOST=mysql
DB_PORT=3306
DB_USER=nanobanana
DB_PASSWORD=your_password
DB_NAME=nanobanana

# Redis
REDIS_HOST=redis
REDIS_PORT=6379

# Admin
ADMIN_ID=123456789
```

### 2. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose
```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f app
docker-compose logs -f worker

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
docker-compose down
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
```bash
# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
docker exec -i mysql_container mysql -u root -p nanobanana < db/create.sql
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–∞—Ä–∏—Ñ—ã (src/services/pricing.py)
```python
PACKS_RUB = [149, 290, 690, 990]
PACKS_CREDITS = {
    149: 50,   # 50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    290: 100,  # 100 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    690: 300,  # 300 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
    990: 500,  # 500 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
}
```

### –ú–æ–¥–µ–ª–∏ Seedream V4

- **Edit**: `bytedance/seedream-v4-edit` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ 10 —Ñ–æ—Ç–æ
- **Text-to-Image**: `bytedance/seedream-v4-text-to-image` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ —Ç–µ–∫—Å—Ç–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

- **–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω**: 9:16, 16:9, 4:3, 3:4, 1:1
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏—è**: 1K, 2K, 4K (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1K)
- **–§–æ—Ä–º–∞—Ç**: PNG

## üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Å—Ç–∞—Ä—Ç
- `/gen` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∑–∞–≥—Ä—É–∑–∏—Ç–µ 1-10 —Ñ–æ—Ç–æ)
- `/create` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—Å—Ç–∞
- `/buy` ‚Äî –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
- `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞
- `/example` ‚Äî –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç
- `/bots` ‚Äî –¥—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã

### –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∞

- `/broadcast` ‚Äî —Ä–∞—Å—Å—ã–ª–∫–∞ (—Ç–µ–∫—Å—Ç/—Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ)
- `/broadcast_status JOB_ID` ‚Äî —Å—Ç–∞—Ç—É—Å —Ä–∞—Å—Å—ã–ª–∫–∏
- `/broadcast_cancel JOB_ID` ‚Äî –æ—Ç–º–µ–Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
- `/broadcast_test` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ vendors/seedream.py      # KIE.ai API –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ queue.py             # ARQ –≤–æ—Ä–∫–µ—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments.py          # YooKassa
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pricing.py           # —Ç–∞—Ä–∏—Ñ—ã
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ commands.py      # –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generation.py   # –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments.py     # –æ–ø–ª–∞—Ç–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice.py         # –≥–æ–ª–æ—Å–æ–≤—ã–µ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ broadcast.py    # —Ä–∞—Å—Å—ã–ª–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards.py         # –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ states.py            # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îî‚îÄ‚îÄ routes/
‚îÇ           ‚îú‚îÄ‚îÄ seedream.py      # webhook —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îÇ           ‚îú‚îÄ‚îÄ yookassa.py      # webhook –æ–ø–ª–∞—Ç—ã
‚îÇ           ‚îî‚îÄ‚îÄ tg.py            # webhook telegram
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ create.sql               # –º–∏–≥—Ä–∞—Ü–∏—è MySQL
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îî‚îÄ‚îÄ requirements.txt
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

JSON-—Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ —Å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º —à—É–º–Ω—ã—Ö INFO:
```python
# src/core/logging.py
logging.getLogger("aiogram.event").setLevel(logging.WARNING)
logging.getLogger("httpx").setLevel(logging.WARNING)
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Webhook –∑–∞—â–∏—â–µ–Ω —Å–µ–∫—Ä–µ—Ç–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
- Rate limiting (30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–ø–∏—Å–∞–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–≤—à–∏—Ö –±–æ—Ç–∞ —é–∑–µ—Ä–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- Health check: `GET /healthz`
- –õ–æ–≥–∏: JSON –≤ stdout
- –ú–µ—Ç—Ä–∏–∫–∏: —á–µ—Ä–µ–∑ –ª–æ–≥–∏

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

Telegram: @guard_gpt

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

Proprietary